{% extends 'base_seller.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
  <!-- Hero -->
  <div class="bg-dark text-white rounded-4 p-4 p-md-5 mb-4 shadow-sm">
    <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
      <div>
        <p class="text-uppercase small mb-2">Studio Konten Digital</p>
        <h2 class="mb-1">Selamat datang kembali, {{ user.first_name|default:user.username }}!</h2>
        <p class="mb-0">Kurasi modul, soal, dan sesi live kamu dari satu tempat. Pantau kualitas dan royalti secara real time.</p>
      </div>      
    </div>
  </div>

  <!-- Snapshot -->
  <div class="row g-3 mb-4">
    <div class="col-sm-6 col-lg-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <p class="text-muted mb-1">Modul Aktif</p>
          <h4 class="mb-2">{{ seller_metrics.total_packages|default:0 }}</h4>
          <small class="text-success">+{{ seller_metrics.new_packages|default:0 }} minggu ini</small>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <p class="text-muted mb-1">Pengguna Aktif</p>
          <h4 class="mb-2">{{ seller_metrics.active_learners|default:0 }}</h4>
          <small class="text-primary">Belajar rata-rata {{ seller_metrics.avg_duration|default:"42 m" }}</small>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <p class="text-muted mb-1">Tingkat Kelulusan</p>
          <h4 class="mb-2">{{ seller_metrics.pass_rate|default:"78%" }}</h4>
          <small class="text-muted">Dari seluruh tryout digital</small>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <p class="text-muted mb-1">Royalti Siap Cair</p>
          <h4 class="mb-2">Rp {{ seller_metrics.royalty_ready|default:"0" }}</h4>
          <a href="#" class="small text-primary">Lihat detail payout &rsaquo;</a>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-lg-8">
      <!-- Performa Konten -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <div class="d-flex flex-column flex-md-row justify-content-between gap-2 mb-3">
            <div>
              <h5 class="mb-1">Performa Konten Digital</h5>
              <small class="text-muted">Ringkasan modul digital berdasarkan data internal.</small>
            </div>
            <div class="btn-group btn-group-sm" role="group">
              <button type="button" class="btn btn-outline-secondary active">Semua</button>
              <button type="button" class="btn btn-outline-secondary">Modul</button>
              <button type="button" class="btn btn-outline-secondary">Tryout</button>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>Konten</th>
                  <th>Harga</th>
                  <th>Paket Soal</th>
                  <th>Dibuat</th>
                  <th>Diperbarui</th>
                </tr>
              </thead>
              <tbody>
                {% for produk in digital_products %}
                  <tr>
                    <td>
                      <strong>{{ produk.nama }}</strong><br>
                      <small class="text-muted">Kategori: {{ produk.kategori|default:"-" }}</small>
                    </td>
                    <td>Rp {{ produk.harga|default:"0" }}</td>
                    <td>{{ produk.paket_soal_count|default:0 }}</td>
                    <td>{{ produk.created_at|date:"d M Y" }}</td>
                    <td>{{ produk.updated_at|date:"d M Y" }}</td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="5" class="text-center text-muted py-4">
                      Belum ada modul digital. Upload konten pertamamu untuk mulai memantau performa.
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Katalog Konten -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between flex-column flex-md-row gap-2 mb-3">
            <div>
              <h5 class="mb-1">Katalog Kontenmu</h5>
              <small class="text-muted">Kelola modul digital, sesi live, dan paket tryout dalam satu grid.</small>
            </div>
            <a href="{% url 'buat_produk' %}" class="btn btn-sm btn-primary align-self-start">Tambah Konten</a>
          </div>
          <div class="row g-3">
            {% for produk in digital_products %}
              <div class="col-md-6">
                <div class="border rounded-4 h-100 p-3">
                  <div class="d-flex justify-content-between mb-2">
                    <span class="badge bg-light text-dark text-uppercase">{{ produk.kategori|default:"Modul" }}</span>
                    <span class="text-muted small">{{ produk.status|default:"Aktif" }}</span>
                  </div>
                  <h6 class="mb-1">{{ produk.nama }}</h6>
                  <p class="small text-muted mb-3">{{ produk.deskripsi_singkat|default:"Belum ada deskripsi singkat." }}</p>
                  <div class="d-flex justify-content-between small text-muted mb-2">
                    <span>Harga: Rp {{ produk.harga|default:"0" }}</span>
                    <span>Paket soal: {{ produk.paket_soal_count|default:0 }}</span>
                  </div>
                  <p class="small text-muted mb-3">Update terakhir {{ produk.updated_at|date:"d M Y" }}</p>
                  <div class="d-flex gap-2 flex-wrap">
                    <a href="#" class="btn btn-sm btn-outline-primary">Lihat Detail</a>
                    <a href="#" class="btn btn-sm btn-outline-secondary">Edit Konten</a>
                  </div>
                </div>
              </div>
            {% empty %}
              <div class="col-12">
                <div class="text-center text-muted py-5">
                  Belum ada produk digital. Mulai dengan membuat modul atau paket soal barumu.
                  <div class="mt-3">
                    <a href="{% url 'buat_produk' %}" class="btn btn-primary btn-sm">Buat Modul Pertama</a>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Status Kurasi -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Review &amp; QC Konten</h5>
            <a href="#" class="small text-primary">Lihat semua antrean</a>
          </div>
          <ul class="list-unstyled mb-0">
            {% for item in pending_reviews %}
              <li class="mb-3 pb-3 border-bottom">
                <div class="d-flex justify-content-between">
                  <div>
                    <strong>{{ item.judul }}</strong>
                    <p class="mb-1 small text-muted">
                      Status: {{ item.status|default:"Menunggu" }} · Catatan QC: {{ item.catatan|default:"-" }}
                    </p>
                    <div class="d-flex gap-2 flex-wrap">
                      <a href="#" class="btn btn-sm btn-outline-primary">Lihat Catatan</a>
                      <a href="#" class="btn btn-sm btn-primary">Perbaiki Sekarang</a>
                    </div>
                  </div>
                  <small class="text-muted">{{ item.updated_at|default:"Baru" }}</small>
                </div>
              </li>
            {% empty %}
              <li class="text-muted">Tidak ada konten dalam antrean review.</li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <!-- Aktivitas -->
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Aktivitas &amp; Notifikasi</h5>
            <a href="#" class="small text-primary">Atur preferensi</a>
          </div>
          <ul class="list-unstyled mb-0">
            {% for log in seller_activity %}
              <li class="mb-3 pb-3 border-bottom">
                <strong>{{ log.title }}</strong>
                <p class="mb-1 small text-muted">{{ log.description }}</p>
                <small class="text-muted">{{ log.timestamp|default:"Baru saja" }}</small>
              </li>
            {% empty %}
              <li class="text-muted">Belum ada notifikasi terbaru.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <h6 class="text-uppercase small text-muted">Keuangan &amp; Royalti</h6>
          <h4 class="mb-2">Rp {{ seller_metrics.royalty_month|default:"0" }}</h4>
          <p class="small text-muted mb-3">Performa bulan ini · target {{ seller_metrics.royalty_target|default:"-" }}</p>
          <div class="progress mb-3" style="height:8px;">
            <div class="progress-bar bg-success" style="width: {{ seller_metrics.royalty_progress|default:45 }}%;"></div>
          </div>
          <div class="d-grid gap-2">
            <a href="#" class="btn btn-sm btn-success">Tarik Dana</a>
            <a href="#" class="btn btn-sm btn-outline-secondary">Riwayat Royalti</a>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <h6 class="text-uppercase small text-muted mb-3">Toolkit Kurator</h6>
          <ul class="list-unstyled small mb-3">
            <li>✓ Pemeriksaan plagiarisme otomatis aktif</li>
            <li>✓ Standar penulisan terbaru 2025</li>
            <li>✓ Monitoring error format soal</li>
          </ul>
          <div class="d-grid gap-2">
            <a href="#" class="btn btn-outline-primary btn-sm">Baca Panduan QC</a>
            <a href="#" class="btn btn-outline-secondary btn-sm">Template Konten</a>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <h6 class="text-uppercase small text-muted mb-2">Kampanye Digital</h6>
          <p class="fw-semibold mb-1">{{ campaign.highlight|default:"Ajak siswa ke sesi live mingguan" }}</p>
          <p class="small text-muted mb-3">{{ campaign.description|default:"Dorong engagement dengan bagikan kode promo webinar." }}</p>
          <a href="#" class="btn btn-sm btn-primary w-100">Kelola Kampanye</a>
        </div>
      </div>

      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <h6 class="text-uppercase small text-muted mb-3">Komunitas &amp; Dukungan</h6>
          <p class="mb-1 fw-semibold">Level Edukator: {{ user.seller_level|default:"Explorer" }}</p>
          <p class="small text-muted">Tinggal {{ seller_metrics.next_level_points|default:120 }} poin lagi menuju level berikutnya.</p>
          <div class="d-grid gap-2 mt-3">
            <a href="#" class="btn btn-outline-primary btn-sm">Gabung Forum Mentors</a>
            <a href="#" class="btn btn-outline-secondary btn-sm">Hubungi Tim Kurator</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
